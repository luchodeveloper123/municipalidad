<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Servicios Urbanos</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='logo.jpg') }}">
</head>
<body class="fondo-institucional">
  <div class="fondo-institucional-fija"></div>
  <div class="layout">

    <!-- MenÃº lateral -->
    <div class="menu-lateral">
      <div>
        <h2>ğŸŒ¿ Mantenimiento de Plazas</h2>
        {% if session['rol'] == 'servicios' %}
          <button onclick="window.location.href='/'">ğŸ  Inicio</button>
          <button onclick="window.location.href='/nueva-plaza'">â• Nueva Plaza</button>
          <button onclick="window.location.href='/registrar-corte'">âœ‚ï¸ Registrar Corte</button>
          <button onclick="window.location.href='/registrar-arreglo'">ğŸ›  Registrar Arreglo</button>
          <button onclick="window.location.href='/arreglos-pendientes'">ğŸ›  Ver arreglos pendientes</button>
          <button onclick="window.location.href='/arreglos-realizados'">âœ… Ver arreglos realizados</button>
          <button onclick="window.location.href='/plazas-cortadas'">âœ‚ï¸ Plazas Cortadas</button>
          <button onclick="window.location.href='/mis-plazas'">ğŸ“‹ Ver mis plazas</button>
          <button onclick="window.location.href='/grafico'">ğŸ“Š Ver grÃ¡fico</button>
        {% elif session['rol'] == 'secretaria' %}
          <button onclick="window.location.href='/'">ğŸ  Inicio</button>
          <button onclick="window.location.href='/registrar-arreglo'">ğŸ›  Registrar Arreglo</button>
          <button onclick="window.location.href='/arreglos-pendientes'">ğŸ›  Ver arreglos pendientes</button>
          <button onclick="window.location.href='/arreglos-realizados'">âœ… Ver arreglos realizados</button>
        {% endif %}
      </div>
      <a href="/logout" style="color:#e74c3c; text-decoration:none; font-weight:bold; font-size:0.95em;">
        ğŸšª Cerrar sesiÃ³n
      </a>
    </div>

    <!-- Contenido principal -->
    <div class="contenido-principal">
      <div class="contenedor-central">
        <h1>ğŸ›  Arreglos Pendientes</h1>

        {% if mensaje %}
          <div class="mensaje-confirmacion">{{ mensaje }}</div>
        {% endif %}

        <form method="GET" action="{{ url_for('arreglos_pendientes') }}" class="formulario-busqueda">
          <label for="plaza">ğŸ Plaza:</label>
          <input type="text" id="plaza" name="plaza" placeholder="Ej: Alsina" value="{{ plaza or '' }}">

          <label for="mes_anio">ğŸ“… Mes:</label>
          <input type="month" id="mes_anio" name="mes_anio" value="{{ mes_anio or '' }}">

          <button type="submit" formaction="#resultados">ğŸ” Filtrar</button>
        </form>

        {% if arreglos %}
          <div id="resultados" class="cuadro-arreglos">
            {% for arreglo in arreglos %}
              <div class="tarjeta-arreglo">
                <p><strong>ğŸ“ Plaza:</strong> {{ arreglo.plaza }}</p>
                <p><strong>ğŸ›  Tarea:</strong> {{ arreglo.descripcion }}</p>
                <ul style="margin-top: 1em;">
                  <li style="margin-bottom: 1em;">
                    <form method="POST" action="{{ url_for('registrar_realizacion') }}">
                      <input type="hidden" name="id_arreglo" value="{{ arreglo.id }}">
                      <input type="hidden" name="plaza" value="{{ arreglo.plaza }}">
                      <input type="hidden" name="mes_anio" value="{{ mes_anio }}">


                      <p><strong>ğŸ“¥ Fecha de peticiÃ³n:</strong> {{ arreglo.fecha_ingreso }}</p>
                      <p><strong>ğŸ“Œ Relevadores:</strong> {{ arreglo.relevadores or 'â€”' }}</p>

                      <label>ğŸ—“ Fecha realizado:
                        <input type="date" name="fecha_realizacion" required>
                      </label>
                      <label>ğŸ‘¥ Personas involucradas:
                        <input type="text" name="personas_involucradas" placeholder="Ej: LÃ³pez, GÃ³mez" required>
                      </label>
                      <button type="submit" style="margin-top: 0.5em;">âœ… Marcar como finalizado</button>
                    </form>

                    <form method="POST"
                          action="{{ url_for('eliminar_arreglo', arreglo_id=arreglo.id) }}"
                          onsubmit="return confirm('Â¿EstÃ¡s seguro de que querÃ©s eliminar este arreglo?');">
                      <input type="hidden" name="mes_anio" value="{{ mes_anio }}">
                      <input type="hidden" name="plaza" value="{{ arreglo.plaza }}">
                      <button type="submit" class="boton-peligro">ğŸ—‘ï¸ Eliminar</button>
                    </form>
                  </li>
                </ul>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div id="resultados" class="mensaje-vacio">
            ğŸ•µï¸â€â™‚ï¸ No se encontraron arreglos pendientes para esa bÃºsqueda.
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <img src="/static/logo.jpg" alt="Logo Municipalidad Tres de Febrero" class="logo-institucional-fijo">
</body>
</html>
