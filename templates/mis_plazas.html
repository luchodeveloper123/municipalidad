<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Servicios Urbanos</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='logo.jpg') }}">
  <style>
    .cuadro-arreglos {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1em;
      margin-top: 1.5em;
    }
    .tarjeta-arreglo {
      background-color: #f0f8ff;
      border: 1px solid #bcd;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 2px 2px 4px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .tarjeta-arreglo h4 {
      margin: 0;
      font-size: 1.1em;
      color: #2b4d66;
    }
    .info-item {
      margin: 0;
      font-size: 0.95em;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="fondo-institucional-fija"></div>
  <div class="layout">
    <div class="menu-lateral">
      <div>
        <h2>ğŸŒ¿ Mantenimiento de Plazas</h2>

        {% if session['rol'] == 'servicios' %}
          <button onclick="window.location.href='/'">ğŸ  Inicio</button>
          <button onclick="window.location.href='/nueva-plaza'">â• Nueva Plaza</button>
          <button onclick="window.location.href='/registrar-corte'">âœ‚ï¸ Registrar Corte</button>
          <button onclick="window.location.href='/registrar-arreglo'">ğŸ›  Registrar Arreglo</button>
          <button onclick="window.location.href='/arreglos-pendientes'">ğŸ›  Ver arreglos pendientes</button>
          <button onclick="window.location.href='/arreglos-realizados'">âœ… Ver arreglos realizados</button>
          <button onclick="window.location.href='/plazas-cortadas'">âœ‚ï¸ Plazas Cortadas</button>
          <button onclick="window.location.href='/mis-plazas'">ğŸ“‹ Ver mis plazas</button>
          <button onclick="window.location.href='/grafico'">ğŸ“Š Ver grÃ¡fico</button>
        {% elif session['rol'] == 'secretaria' %}
          <button onclick="window.location.href='/'">ğŸ  Inicio</button>
          <button onclick="window.location.href='/registrar-arreglo'">ğŸ›  Registrar Arreglo</button>
          <button onclick="window.location.href='/arreglos-pendientes'">ğŸ›  Ver arreglos pendientes</button>
          <button onclick="window.location.href='/arreglos-realizados'">âœ… Ver arreglos realizados</button>
        {% endif %}
      </div>

      <a href="/logout"
         style="color:#e74c3c; text-decoration:none; font-weight:bold; font-size:0.95em;">
        ğŸšª Cerrar sesiÃ³n
      </a>
    </div>

    <div class="contenido-principal">
      <div class="contenedor-arreglos-realizados">
        <h1>ğŸ“‹ Mis Plazas</h1>

        <form method="GET"
              action="{{ url_for('mis_plazas') }}"
              style="display:flex; flex-direction:column;
                     align-items:flex-start; gap:0.5em;
                     max-width:300px; margin-bottom:2em;">
          <label for="busqueda">ğŸ Buscar plaza:</label>
          <input type="text" id="busqueda"
                 name="busqueda"
                 placeholder="Ej: Plaza San MartÃ­n"
                 value="{{ texto }}"
                 style="width:100%; padding:6px;">
          <button type="submit" style="padding:6px 12px;">ğŸ” Buscar</button>
        </form>

        {% if plazas %}
          <div class="cuadro-arreglos">
            {% for plaza in plazas %}
              {% set plaza_id = plaza[0] %}
              <div class="tarjeta-arreglo">
                <h4>{{ plaza[1] }}</h4>
                <p class="info-item">ğŸ“ {{ plaza[2] }}</p>

                <!-- Eliminar plaza -->
                <div style="text-align:right; margin-top:8px;">
                  <a href="#"
                     style="color:#e74c3c;
                            text-decoration:none;
                            font-size:0.9em;"
                     onclick="if(confirm('Â¿Eliminar esta plaza?')){ this.nextElementSibling.submit(); }">
                    ğŸ—‘ï¸ Eliminar plaza
                  </a>
                  <form action="/eliminar-plaza"
                        method="POST"
                        style="display:none;">
                    <input type="hidden"
                           name="plaza_id"
                           value="{{ plaza_id }}">
                  </form>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p style="margin-top:2em;
                    font-style:italic;
                    color:gray;">
            No hay plazas registradas o coincidentes con la bÃºsqueda.
          </p>
        {% endif %}
      </div>
    </div>
  </div>

  <img src="/static/logo.jpg"
       alt="Logo Municipalidad Tres de Febrero"
       class="logo-institucional-fijo">
</body>
</html>
